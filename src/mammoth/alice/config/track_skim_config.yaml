---
# NOTE: Convention for map keys and anchors - if they lead with an `_`, they are meant to be private,
#       which is to say, not to be used directly in a production.  Nothing is critical here - it's
#       just to make it easier to keep track of everything.
skimmed_datasets:
  # pp
  # LHC17pq pass 1
  LHC17pq_pass1_AOD234_2111_2112: &LHC17pq_pp
    name: "LHC17pq_pass1_AOD234_2111_2112"
    collision_system: "pp"
    sqrt_s: 5020
    period: "LHC17pq"
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_pp"
    tree_name: "AliAnalysisTaskTrackSkim_pp_tree"
    levels_in_output_file:
      - "data"
    files:
      # LHC17p
      - "trains/pp/2111/run_by_run/LHC17p_CENT_woSDD/*/AnalysisResults.17p.*.root"
      - "trains/pp/2111/run_by_run/LHC17p_FAST/*/AnalysisResults.17p.*.root"
      # LHC17q
      - "trains/pp/2112/run_by_run/LHC17q_CENT_woSDD/*/AnalysisResults.17q.*.root"
      - "trains/pp/2112/run_by_run/LHC17q_FAST/*/AnalysisResults.17q.*.root"
  # LHC17pq pass 2
  LHC17pq_pass2_AOD_2351_2352: &LHC17pq_pp_pass2
    name: "LHC17pq_pass2_AOD_2351_2352"
    collision_system: "pp"
    sqrt_s: 5020
    period: "LHC17pq"
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_pp"
    tree_name: "AliAnalysisTaskTrackSkim_pp_tree_v3"
    levels_in_output_file:
      - "data"
    files:
      # LHC17p
      - "trains/pp/2351/run_by_run/LHC17p_CENT_woSDD/*/AnalysisResults.17p.*.root"
      - "trains/pp/2351/run_by_run/LHC17p_FAST/*/AnalysisResults.17p.*.root"
      # LHC17q
      - "trains/pp/2352/run_by_run/LHC17q_CENT_woSDD/*/AnalysisResults.17q.*.root"
      - "trains/pp/2352/run_by_run/LHC17q_FAST/*/AnalysisResults.17q.*.root"

  # pp_MC
  # pythia
  # Anchored to LHC17pq pass1
  LHC18b8_AOD_2619: &LHC18b8_pythia
    name: "LHC18b8_AOD_2619"
    collision_system: "pythia"
    sqrt_s: 5020
    period: "LHC18b8"
    anchor_period: ["LHC17p", "LHC17q"]
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_pythia"
    tree_name: "AliAnalysisTaskTrackSkim_pythia_tree"
    levels_in_output_file:
      - "data"
      - "gen"
    n_pt_hat_bins: 20
    files:
      - "trains/pythia/2619/run_by_run/LHC18b8_cent_woSDD/*/{pt_hat_bin}/AnalysisResults.18b8_cent_woSDD.*.root"
      - "trains/pythia/2619/run_by_run/LHC18b8_fast/*/{pt_hat_bin}/AnalysisResults.18b8_fast.*.root"
  # Anchored to LHC17pq pass2
  LHC23a3_AOD_2907: &LHC23a3_pythia
    name: "LHC23a3_AOD_2907"
    collision_system: "pythia"
    sqrt_s: 5020
    period: "LHC23a3"
    anchor_period: ["LHC17p", "LHC17q"]
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_pythia"
    tree_name: "AliAnalysisTaskTrackSkim_pythia_tree"
    levels_in_output_file:
      - "data"
      - "gen"
    n_pt_hat_bins: 20
    files:
      - "trains/pythia/2907/run_by_run/LHC23a3_cent_woSDD/*/{pt_hat_bin}/AnalysisResults.23a3_cent_woSDD.*.root"
      - "trains/pythia/2907/run_by_run/LHC23a3_fast/*/{pt_hat_bin}/AnalysisResults.23a3_fast.*.root"

  # Anchored to LHC18qr pass3
  LHC20g4_AOD_2640: &LHC20g4_pythia
    name: "LHC20g4_AOD_2640"
    collision_system: "pythia"
    sqrt_s: 5020
    period: "LHC20g4"
    anchor_period: ["LHC18q", "LHC18r"]
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_pythia"
    tree_name: "AliAnalysisTaskTrackSkim_pythia_tree"
    levels_in_output_file:
      - "data"
      - "gen"
    n_pt_hat_bins: 20
    files:
      - "trains/pythia/2640/run_by_run/LHC20g4/*/{pt_hat_bin}/AnalysisResults.20g4.*.root"
  # LBL Fast Sims
  # This is a FastSim of the LHC18b8 Pythia production anchored to 17pq
  LBL20_Pythia_FastSim_1_258314: &LBL20_Pythia_FastSim_1_17pq
    name: "LBL20_Pythia_FastSim_1_258314"
    collision_system: "pythia"
    generator: "pythia"
    sqrt_s: 5020
    period: "LBL20_Pythia_FastSim_1"
    anchor_period: ["LHC17p", "LHC17q"]
    # Keep track of the skim type for documentation
    skim_type: "HF_tree_at_LBL"
    # NOTE: The scale factors need to be copied to the appropriate production directory
    # Binning is the standard binning for LHC18b8
    n_pt_hat_bins: 20
    number_of_parent_directories_to_pt_hat_bin: 3
    # Number of parent directories to go up to create the relative output filename
    # NOTE: Only needed if the inputs are not in the trains directory, as is the cause on hiccup
    # NOTE: We go up to 5 since the run numbers overlap between FAST and CENT_woSDD, so they will
    #       overwrite each other unless we known which child train output they are from.
    number_of_parent_directories_for_relative_output_filename: 5
    files:
      - "trains/pythia/258314/files.txt"
  # Anchored is unclear, but I suspect that it's LHC17pq (?)
  LBL20_Herwig_FastSim_1_266374: &LBL20_Herwig_FastSim_1_17pq
    name: "LBL20_Herwig_FastSim_1_266374"
    collision_system: "pythia"
    # Generator config at: `pyjetty/pyjetty/alice_analysis/generation/herwig/herwig_slurm.sh`
    generator: "herwig"
    sqrt_s: 5020
    period: "LBL20_Herwig_FastSim_1"
    anchor_period: ["LHC17p", "LHC17q"]
    # Keep track of the skim type for documentation
    skim_type: "HF_tree_at_LBL"
    # NOTE: The scale factors need to be copied to the appropriate production directory
    # Binning: (5 7 9 12 16 21 28 36 45 57 70 85 99 115 132 150 169 190 212 235 260)
    n_pt_hat_bins: 20
    number_of_parent_directories_to_pt_hat_bin: 2
    # Number of parent directories to go up to create the relative output filename
    # NOTE: Only needed if the inputs are not in the trains directory, as is the cause on hiccup
    number_of_parent_directories_for_relative_output_filename: 3
    files:
      - "trains/pythia/266374/files.txt"
  # JETSCAPE PP19
  # Arbitrarily defined as #1 in JETSCAPE productions
  JETSCAPE_PP19_1: &JETSCAPE_PP19
    name: "JETSCAPE_PP19_1"
    collision_system: "pp_MC"
    sqrt_s: 5020
    period: ""
    # Keep track of the skim type for documentation
    skim_type: "jetscape"
    legacy_skim: true
    # Parameters of the output
    n_pt_hat_bins: 66
    files:
      - "trains/pp_MC/jetscape/0001/JetscapeHadronListBin*.parquet"
  # JEWEL pp
  # Particle level only
  LBL21_JEWEL_823890: &LBL21_JEWEL_pp_1
    name: "LBL21_JEWEL_823890"
    collision_system: "pp_MC"
    generator: "jewel"
    sqrt_s: 5020
    period: "LBL21_JEWEL_pp_1"
    # Keep track of the skim type for documentation
    skim_type: "HF_tree_at_LBL"
    # NOTE: The scale factors need to be copied to the appropriate production directory
    # Binning: (5 7 9 12 16 21 28 36 45 57 70 85 99 115 132 150 169 190 212 235 260)
    n_pt_hat_bins: 20
    number_of_parent_directories_to_pt_hat_bin: 2
    # Number of parent directories to go up to create the relative output filename
    # NOTE: Only needed if the inputs are not in the trains directory, as is the cause on hiccup
    number_of_parent_directories_for_relative_output_filename: 3
    files:
      - "trains/pp_MC/823890/files.txt"

  # PbPb
  LHC18qr_pass3_AOD252_central_642: &LHC18qr_PbPb_central
    name: "LHC18qr_pass3_AOD252_central_642"
    collision_system: "PbPb"
    sqrt_s: 5020
    period: ["LHC18q", "LHC18r"]
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_PbPb_central"
    tree_name: "AliAnalysisTaskTrackSkim_PbPb_central_tree"
    levels_in_output_file:
      - "data"
    files:
      - "trains/PbPb/642/run_by_run/LHC18q/*/AnalysisResults.18q.*.root"
      - "trains/PbPb/642/run_by_run/LHC18r/*/AnalysisResults.18r.*.root"
  LHC18qr_pass3_AOD252_semi_central_645: &LHC18qr_PbPb_semi_central
    name: "LHC18qr_pass3_AOD252_semi_central_645"
    collision_system: "PbPb"
    sqrt_s: 5020
    period: ["LHC18q", "LHC18r"]
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_PbPb_semi_central"
    tree_name: "AliAnalysisTaskTrackSkim_PbPb_semi_central_tree"
    levels_in_output_file:
      - "data"
    files:
      - "trains/PbPb/645/run_by_run/LHC18q/*/AnalysisResults.18q.*.root"
      - "trains/PbPb/645/run_by_run/LHC18r/*/AnalysisResults.18r.*.root"
  LHC15o_pass1_AOD194_central_7666: &LHC15o_PbPb_central
    name: "LHC15o_pass1_AOD194_central_7666"
    collision_system: "PbPb"
    sqrt_s: 5020
    period: "LHC15o"
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_PbPb_central"
    tree_name: "AliAnalysisTaskTrackSkim_PbPb_central_tree"
    levels_in_output_file:
      - "data"
    files:
      - "trains/PbPb/7666/run_by_run/LHC15o/*/AnalysisResults.15o.*.root"
  LHC15o_pass1_AOD194_semi_central_7668: &LHC15o_PbPb_semi_central
    name: "LHC15o_pass1_AOD194_semi_central_7668"
    collision_system: "PbPb"
    sqrt_s: 5020
    period: "LHC15o"
    # Keep track of the skim type for documentation
    skim_type: "track_skim"
    # Parameters of the output
    list_name: "AliAnalysisTaskTrackSkim_PbPb_semi_central"
    tree_name: "AliAnalysisTaskTrackSkim_PbPb_semi_central_tree"
    levels_in_output_file:
      - "data"
    files:
      - "trains/PbPb/7668/run_by_run/LHC15o/*/AnalysisResults.15o.*.root"

  # PbPb_MC
  LBL21_JEWEL_NoRecoils_FastSim_1_798301: &LBL21_JEWEL_NoRecoils_FastSim_1
    name: "LBL21_JEWEL_NoRecoils_FastSim_1_798301"
    collision_system: "PbPb_MC"
    generator: "jewel"
    sqrt_s: 5020
    period: "LBL21_JEWEL_NoRecoils_FastSim_1"
    # Keep track of the skim type for documentation
    skim_type: "HF_tree_at_LBL"
    # NOTE: The scale factors need to be copied to the appropriate production directory
    # Binning: (5 7 9 12 16 21 28 36 45 57 70 85 99 115 132 150 169 190 212 235 260)
    n_pt_hat_bins: 20
    number_of_parent_directories_to_pt_hat_bin: 2
    # Number of parent directories to go up to create the relative output filename
    # NOTE: Only needed if the inputs are not in the trains directory, as is the cause on hiccup
    number_of_parent_directories_for_relative_output_filename: 3
    files:
      #- "trains/PbPb_MC/798301/files.txt"
      - "trains/PbPb_MC/798301/files_test.txt"
  LBL21_JEWEL_Recoils_FastSim_1_996432: &LBL21_JEWEL_Recoils_FastSim_1
    name: "LBL21_JEWEL_Recoils_FastSim_1_996432"
    collision_system: "PbPb_MC"
    generator: "jewel"
    sqrt_s: 5020
    period: "LBL21_JEWEL_Recoils_FastSim_1"
    # Keep track of the skim type for documentation
    skim_type: "HF_tree_at_LBL"
    # NOTE: The scale factors need to be copied to the appropriate production directory
    # Binning: (5 7 9 12 16 21 28 36 45 57 70 85 99 115 132 150 169 190 212 235 260)
    n_pt_hat_bins: 20
    number_of_parent_directories_to_pt_hat_bin: 2
    # Number of parent directories to go up to create the relative output filename
    # NOTE: Only needed if the inputs are not in the trains directory, as is the cause on hiccup
    number_of_parent_directories_for_relative_output_filename: 3
    files:
      - "trains/PbPb_MC/996432/files.txt"

dataset_metadata_settings:
  _base:
    _pp: &base_metadata_pp
      # Parameters relevant for loading the dataset
      # Map from value -> key of how prefixes should be renamed when loading data
      loading_data_rename_levels:
        data: "data"

    _pythia: &base_metadata_pythia
      # Parameters relevant for loading the dataset
      # Map from value -> key of how prefixes should be renamed when loading data
      # For pythia, this isn't necessary since it has a dedicated function for loading MC data
      loading_data_rename_levels: {}

    _PbPb: &base_metadata_PbPb
      # Parameters relevant for loading the dataset
      # Map from value -> key of how prefixes should be renamed when loading data
      loading_data_rename_levels:
        data: "data"

    _embed: &base_metadata_embed
      # Parameters relevant for loading the dataset
      # Map from value -> key of how prefixes should be renamed when loading data
      # For embedding, this isn't necessary since it has a dedicated function for loading embedding data
      loading_data_rename_levels: {}
      input_constrained_source: "signal"
      input_handling:
        signal_parameters:
          collision_system: "pythia"
          constrained_source: # ie. signal is the constraint
            n_files_to_use_per_task: 1
          unconstrained_source:
            # Sample pt hat bin distribution equally
            # NOTE: This option isn't meaningful in the constrained source case
            sample_each_pt_hat_bin_equally: true
            # Number of signal files to make available to a background file
            # This ensures some additional diversity if we end up with a very small signal file
            n_files_to_use_per_task: 3
        background_parameters:
          collision_system: "PbPb"
          constrained_source: # ie. background is the constraint
            n_files_to_use_per_task: 1
          unconstrained_source:
            n_files_to_use_per_task: 2

    _embed_thermal_model: &base_metadata_embed_thermal_model
      # Parameters relevant for loading the dataset
      # Map from value -> key of how prefixes should be renamed when loading data
      # For embedding, this isn't necessary since it has a dedicated function for loading embedding data
      loading_data_rename_levels: {}

    _PbPb_MC: &base_metadata_PbPb_MC
      # Parameters relevant for loading the dataset
      # Map from value -> key of how prefixes should be renamed when loading data
      loading_data_rename_levels:
        data: "part_level"

analysis_settings:
  # This is the base - ie. the default - settings for reclustered substructure
  _reclustered_substructure_settings:
    _pp: &_reclustered_substructure_settings_pp
      track_skim_to_flat_skim_level_names: # Map from track_skim level -> level of the structured jet substructure format
        data: "data"
      analysis_input_levels:
        - "data"
      splittings_selection: "iterative"
      # In GeV
      min_jet_pt: { "data": 5 }

    _pythia: &_reclustered_substructure_settings_pythia
      track_skim_to_flat_skim_level_names: # Map from track_skim level -> level of the structured jet substructure format
        det_level: "data"
        part_level: "true"
      analysis_input_levels: ["det_level", "part_level"]
      splittings_selection: "iterative"
      # In GeV
      # We don't want to restrict the part_level
      min_jet_pt: { "det_level": 5 }
      # By default, don't apply any additional reduction
      det_level_artificial_tracking_efficiency: 1.0

    _PbPb: &_reclustered_substructure_settings_PbPb
      track_skim_to_flat_skim_level_names: # Map from track_skim level -> level of the structured jet substructure format
        data: "data"
      analysis_input_levels: ["data"]
      splittings_selection: "iterative"
      # In GeV
      min_jet_pt: { "data": 20 }

    _embed: &_reclustered_substructure_settings_embed
      track_skim_to_flat_skim_level_names: # Map from track_skim level -> level of the structured jet substructure format
        hybrid_level: "hybrid"
        det_level: "det_level"
        part_level: "true"
      analysis_input_levels: ["hybrid_level", "det_level", "part_level"]
      splittings_selection: "iterative"
      # In GeV
      # We don't want to restrict the "det_level" or "part_level" jet pt values
      min_jet_pt: { "hybrid_level": 20 }

  _hardest_kt_settings:
    _standard_parameters:
      selected_grooming_methods: &hardest_kt_selected_grooming_methods
        - "dynamical_core"
        - "dynamical_kt"
        - "dynamical_time"
        - "dynamical_core_z_cut_02"
        - "dynamical_kt_z_cut_02"
        - "dynamical_time_z_cut_02"
        - "soft_drop_z_cut_02"
        - "soft_drop_z_cut_04"
    pp_R02: &analysis_settings_hardest_kt_pp_R02
      <<: *_reclustered_substructure_settings_pp
      jet_R: 0.2
      selected_grooming_methods: *hardest_kt_selected_grooming_methods
    pp_R04: &analysis_settings_hardest_kt_pp_R04
      <<: *_reclustered_substructure_settings_pp
      jet_R: 0.4
      selected_grooming_methods: *hardest_kt_selected_grooming_methods

    pythia_R02: &analysis_settings_hardest_kt_pythia_R02
      <<: *_reclustered_substructure_settings_pythia
      jet_R: 0.2
      selected_grooming_methods: *hardest_kt_selected_grooming_methods
    pythia_R04: &analysis_settings_hardest_kt_pythia_R04
      <<: *_reclustered_substructure_settings_pythia
      jet_R: 0.4
      selected_grooming_methods: *hardest_kt_selected_grooming_methods

    PbPb_R02: &analysis_settings_hardest_kt_PbPb_R02
      <<: *_reclustered_substructure_settings_PbPb
      jet_R: 0.2
      selected_grooming_methods: *hardest_kt_selected_grooming_methods

    embed_R02: &analysis_settings_hardest_kt_embed_R02
      <<: *_reclustered_substructure_settings_embed
      jet_R: 0.2
      selected_grooming_methods: *hardest_kt_selected_grooming_methods

  _time_reclustering_settings:
    reclustering_settings: &_time_reclustering_reclustering_settings
      algorithm: "generalized_kt"
      additional_algorithm_parameter: 0.5

    output_settings: &time_reclustering_output_settings
      primary_output:
        type: "skim"
        reference_name: "tree"
        container_name: ""
      return_skim: false
      write_chunk_skim: true
      write_skim_extension: "root"
      explode_skim_fields_to_separate_directories: false
      return_merged_hists: false
      write_chunk_hists: false
      write_merged_hists: false

    pp_R04: &analysis_settings_time_reclustering_pp_R04
      <<: *_reclustered_substructure_settings_pp
      jet_R: 0.4
      reclustering_settings:
        <<: *_time_reclustering_reclustering_settings

    pp_MC_R04: &analysis_settings_time_reclustering_pp_MC_R04
      <<: *_reclustered_substructure_settings_pythia
      jet_R: 0.4
      reclustering_settings:
        <<: *_time_reclustering_reclustering_settings

    PbPb_R04: &analysis_settings_time_reclustering_PbPb_R04
      <<: *_reclustered_substructure_settings_PbPb
      jet_R: 0.4
      reclustering_settings:
        <<: *_time_reclustering_reclustering_settings

    embed_R04: &analysis_settings_time_reclustering_embed_R04
      <<: *_reclustered_substructure_settings_embed
      jet_R: 0.4
      reclustering_settings:
        <<: *_time_reclustering_reclustering_settings

  _EEC_analysis_settings:
    base_analysis_settings: &_base_analysis_settings_EEC
      trigger_parameters:
        classes:
          reference: [5., 7.]
          signal: [20., 50.]
        parameters:
          type: "hadron"
          kinematic_label: "pt"
      trigger_parameters_jet:
        classes:
          signal: [20., 120.]
        parameters:
          type: "jet"
          kinematic_label: "pt"
          jet_R: 0.4
      trigger_parameters_photon:
        classes:
          reference: [5., 7.]
          signal: [20, 50]
        parameters:
          type: "photon"
          kinematic_label: "E"
          isolation_cone: 0.4
          max_background_in_isolation: 2. # in GeV
      momentum_weight_exponent: 1

    pp: &analysis_settings_EEC_pp
      <<: *_base_analysis_settings_EEC
      # In GeV
      min_track_pt:
        data: 1.

    pythia: &analysis_settings_EEC_pythia
      <<: *_base_analysis_settings_EEC
      # In GeV
      min_track_pt:
        part_level: 1.
        det_level: 1.

    PbPb: &analysis_settings_EEC_PbPb
      <<: *_base_analysis_settings_EEC
      # In GeV
      min_track_pt:
        data: 1.

    embed: &analysis_settings_EEC_embed
      <<: *_base_analysis_settings_EEC
      # In GeV
      min_track_pt:
        part_level: 1.
        det_level: 1.
        hybrid_level: 1.

  # NOTE: We don't need an explicit one for embedding into a thermal model - we can
  #       just take the standard embedding analysis settings

productions:
  pp:
    2:
      metadata:
        <<: *base_metadata_pp
        dataset: *LHC17pq_pp
        production_number: 2
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pp_R02
    3:
      metadata:
        <<: *base_metadata_pp
        dataset: *LHC17pq_pp_pass2
        production_number: 3
        label: ""
      settings:
        <<: *analysis_settings_time_reclustering_pp_R04
        output_settings:
          <<: *time_reclustering_output_settings
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
    60:
      # R = 0.2 pp production
      metadata:
        <<: *base_metadata_pp
        dataset: *LHC17pq_pp
        production_number: 60
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pp_R02
    61:
      # R = 0.4 pp production
      metadata:
        <<: *base_metadata_pp
        dataset: *LHC17pq_pp
        production_number: 61
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pp_R04
    62:
      # R = 0.2 pp pass 2 production
      metadata:
        <<: *base_metadata_pp
        dataset: *LHC17pq_pp_pass2
        production_number: 62
        label: ""

  pythia:
    # Debug
    3:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LHC18b8_pythia
        production_number: 3
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
    4:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Herwig_FastSim_1_17pq
        production_number: 4
        label: "herwig"
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
    # Production
    60:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LHC18b8_pythia
        production_number: 60
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
    61:
      # Tracking efficiency systematic
      metadata:
        <<: *base_metadata_pythia
        dataset: *LHC18b8_pythia
        production_number: 61
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
        apply_pt_dependent_tracking_efficiency_uncertainty: true
    62:
      # Tracking efficiency systematic (for consistency with the preliminaries)
      metadata:
        <<: *base_metadata_pythia
        dataset: *LHC18b8_pythia
        production_number: 62
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
        det_level_artificial_tracking_efficiency: 0.96
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    63:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Herwig_FastSim_1_17pq
        production_number: 63
        label: "herwig_fastsim"
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
    64:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Pythia_FastSim_1_17pq
        production_number: 64
        label: "pythia_fastsim"
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
    65:
      # R = 0.4 production
      metadata:
        <<: *base_metadata_pythia
        dataset: *LHC18b8_pythia
        production_number: 65
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R04
    66:
      # R = 0.4 production, tracking efficiency systematic
      metadata:
        <<: *base_metadata_pythia
        dataset: *LHC18b8_pythia
        production_number: 66
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R04
        apply_pt_dependent_tracking_efficiency_uncertainty: true
    67:
      # R = 0.4 HERWIG fastsim
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Herwig_FastSim_1_17pq
        production_number: 67
        label: "herwig_fastsim"
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R04
    68:
      # R = 0.4 PYTHIA fastsim
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Pythia_FastSim_1_17pq
        production_number: 68
        label: "pythia_fastsim"
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R04

  pp_MC:
    3:
      metadata:
        dataset: *JETSCAPE_PP19
        production_number: 3
        label: ""
      settings:
        <<: *analysis_settings_hardest_kt_pythia_R02
    # Time reclustering pythia test
    # NOTE: This is the wrong dataset for pythia, but its useful for testing
    4:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LHC20g4_pythia
        production_number: 4
        label: ""
      settings:
        <<: *analysis_settings_time_reclustering_pp_MC_R04
        output_settings:
          <<: *time_reclustering_output_settings
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
    # Time reclustering pythia fastsim
    5:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Pythia_FastSim_1_17pq
        production_number: 5
        label: "pythia_fastsim"
      settings:
        <<: *analysis_settings_time_reclustering_pp_MC_R04
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
    # Time reclustering pythia fastsim - hiccup stability test
    6:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Pythia_FastSim_1_17pq
        production_number: 6
        label: "pythia_fastsim"
      settings:
        <<: *analysis_settings_time_reclustering_pp_MC_R04
        # Setting this to null uses the default CA reclustering settings
        reclustering_settings: null
        chunk_size: 5000
        output_settings:
          <<: *time_reclustering_output_settings
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
    # NOTE: Starts at 69 to be consistent with the "pythia", which this generalizes from.
    # Pythia fastsim w/ time reclustering
    69:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Pythia_FastSim_1_17pq
        production_number: 69
        label: "pythia_fastsim"
      settings:
        <<: *analysis_settings_time_reclustering_pp_MC_R04
        output_settings:
          <<: *time_reclustering_output_settings
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
    # Herwig fastsim w/ time reclustering
    70:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Herwig_FastSim_1_17pq
        production_number: 70
        label: "herwig_fastsim"
      settings:
        <<: *analysis_settings_time_reclustering_pp_MC_R04
        output_settings:
          <<: *time_reclustering_output_settings
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
    # Pythia fastsim w/ CA reclustering
    71:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Pythia_FastSim_1_17pq
        production_number: 71
        label: "pythia_fastsim"
      settings:
        <<: *analysis_settings_time_reclustering_pp_MC_R04
        reclustering_settings: null
        output_settings:
          <<: *time_reclustering_output_settings
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
    # Herwig fastsim w/ CA reclustering
    72:
      metadata:
        <<: *base_metadata_pythia
        dataset: *LBL20_Herwig_FastSim_1_17pq
        production_number: 72
        label: "herwig_fastsim"
      settings:
        <<: *analysis_settings_time_reclustering_pp_MC_R04
        reclustering_settings: null
        output_settings:
          <<: *time_reclustering_output_settings
        selected_grooming_methods:
          - "soft_drop_z_cut_02"

  PbPb:
    2:
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 2
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.5
    3:
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 3
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
    # Time reclustering PbPb
    4:
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 4
        label: "semi_central"
      settings:
        <<: *analysis_settings_time_reclustering_PbPb_R04
        selected_grooming_methods:
          - "soft_drop_z_cut_02"
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.25
    60:
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 60
        label: "central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "central"
    61:
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 61
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.5
    62:
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 62
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
    63:
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 63
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.7
    # *****************************
    # Start of validated track skim
    # *****************************
    64:
      # Nominal, r_max = 0.1
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 64
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.1
    65:
      # Background systematic, r_max = 0.05
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 65
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
    66:
      # Background systematic, r_max = 0.50
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 66
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.50
    # **********************************************
    # Added new grooming methods, adding z_cut to DyG
    # ***********************************************
    67:
      # Nominal, r_max = 0.1. Added 31 Jan 2023
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 67
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.1
    68:
      # Background systematic, r_max = 0.05. Added 31 Jan 2023
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        production_number: 68
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
    69:
      # Background systematic, r_max = 0.50. Added 31 Jan 2023
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_semi_central
        production_number: 69
        label: "semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.50
    70:
      # Nominal, central, r_max = 0.1. Added 4 Feb 2023
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_central
        production_number: 70
        label: "central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "central"
        background_subtraction:
          r_max: 0.1
    71:
      # Background systematic, r_max = 0.05. Added 6 Feb 2023
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_central
        production_number: 71
        label: "central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "central"
        background_subtraction:
          r_max: 0.05
    72:
      # Background systematic, r_max = 0.50. Added 6 Feb 2023
      metadata:
        <<: *base_metadata_PbPb
        dataset: *LHC18qr_PbPb_central
        production_number: 72
        label: "central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        event_activity: "central"
        background_subtraction:
          r_max: 0.50

  PbPb_MC:
    # Testing with JEWEL no recoils
    2:
      metadata:
        <<: *base_metadata_PbPb_MC
        dataset: *LBL21_JEWEL_NoRecoils_FastSim_1
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 2
        label: "central"
      settings:
        <<: *analysis_settings_hardest_kt_PbPb_R02
        output_settings:
          # Utilize the time reclustering output settings for convenience in testing
          <<: *time_reclustering_output_settings
        event_activity: "central"
        # No background subtraction
        # And disable artificial tracking efficiency
        det_level_artificial_tracking_efficiency: 1.0

  embed_pythia:
    2:
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 2
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
        # Artificial tracking efficiency derived from the full jet R_AA paper.
        # 10-30 \approx .99
        # 0-10% \approx .98
        # Apply only to embedded particles
        det_level_artificial_tracking_efficiency: 0.99
    3:
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 3
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.99
    4:
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 4
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        #chunk_size: 15000
        chunk_size: 5000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.99
    60:
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 60
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
        det_level_artificial_tracking_efficiency: 0.99
    61:
      # Additional statistics for production 60
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 61
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
        det_level_artificial_tracking_efficiency: 0.99
    62:
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 62
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.7
        det_level_artificial_tracking_efficiency: 0.99
    63:
      # Additional statistics for production 62
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 63
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.7
        det_level_artificial_tracking_efficiency: 0.99
    # *****************************
    # Start of validated track skim
    # *****************************
    # NOTE: For now, we use background as the constraint, but we'll try to keep working on moving to the
    #       signal as the constraint
    64:
      # Nominal, r_max = 0.1
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 64
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.99
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    65:
      # Background systematic, r_max = 0.05
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 65
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.05
        det_level_artificial_tracking_efficiency: 0.99
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    66:
      # Background systematic, r_max = 0.50
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 66
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        background_subtraction:
          r_max: 0.50
        det_level_artificial_tracking_efficiency: 0.99
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    # **********************************************
    # Added new grooming methods, adding z_cut to DyG
    # ***********************************************
    # Attempt to switch to signal as the constraint from here!
    67:
      # Nominal, r_max = 0.1. Added 31 Jan 23023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        production_number: 67
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.99
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    68:
      # Background systematic, r_max = 0.05. Added 31 Jan 2023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        production_number: 68
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.05
        det_level_artificial_tracking_efficiency: 0.99
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    69:
      # Background systematic, r_max = 0.50. Added 31 Jan 2023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        production_number: 69
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.50
        det_level_artificial_tracking_efficiency: 0.99
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    70:
      # Tracking efficiency systematic, r_max = 0.1. Added 5 Feb 2023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        production_number: 70
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.95
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    #########
    # Central
    #########
    71:
      # Central nominal, r_max = 0.1. Added 6 Feb 2023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_central
        signal_dataset: *LHC20g4_pythia
        production_number: 71
        label: "embed_pythia_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.98
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    72:
      # Background systematic, r_max = 0.05. Added 6 Feb 2023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_central
        signal_dataset: *LHC20g4_pythia
        production_number: 72
        label: "embed_pythia_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.05
        det_level_artificial_tracking_efficiency: 0.98
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    73:
      # Background systematic, r_max = 0.50
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_central
        signal_dataset: *LHC20g4_pythia
        production_number: 73
        label: "embed_pythia_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.50
        det_level_artificial_tracking_efficiency: 0.98
        apply_pt_dependent_tracking_efficiency_uncertainty: false
    74:
      # Tracking efficiency systematic, r_max = 0.1. Added 5 Feb 2023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_central
        signal_dataset: *LHC20g4_pythia
        production_number: 74
        label: "embed_pythia_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.98
        apply_pt_dependent_tracking_efficiency_uncertainty: true
    75:
      # Tracking efficiency systematic with pt dependence for semi-central, r_max = 0.1. Added 14 Feb 2023
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_semi_central
        signal_dataset: *LHC20g4_pythia
        production_number: 75
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.99
        apply_pt_dependent_tracking_efficiency_uncertainty: true
    76:
      # Tracking efficiency systematic without pt dependence, r_max = 0.1. Added 14 Feb 2023
      # Since the central was not approved previously, there's no need to use the standard 4% - I can
      # just jump right to the pt dependent approach.
      metadata:
        <<: *base_metadata_embed
        dataset: *LHC18qr_PbPb_central
        signal_dataset: *LHC20g4_pythia
        production_number: 76
        label: "embed_pythia_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.94
        apply_pt_dependent_tracking_efficiency_uncertainty: false

  embed_thermal_model:
    2:
      metadata:
        <<: *base_metadata_embed_thermal_model
        dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 2
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 5000
        background_subtraction:
          r_max: 0.25
        # Artificial tracking efficiency derived from the full jet R_AA paper.
        # 10-30 \approx .99
        # 0-10% \approx .98
        # Apply only to embedded particles
        det_level_artificial_tracking_efficiency: 0.99

    3:
      # Debug EECs
      metadata:
        dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 3
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_EEC_embed
        event_activity: "central"
        chunk_size: 1000
        output_trigger_skim: true
        # Artificial tracking efficiency to convert tracking in PYTHIA to similar performance as PbPb
        # Applied only to embedded particles
        det_level_artificial_tracking_efficiency: 0.98
    4:
      # EECs with a fraction of stats on my MBP
      metadata:
        dataset: *LHC20g4_pythia
        sample_dataset_fraction: 0.1
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 4
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_EEC_embed
        event_activity: "central"
        chunk_size: 1000
        output_trigger_skim: true
        # Artificial tracking efficiency to convert tracking in PYTHIA to similar performance as PbPb
        # Applied only to embedded particles
        det_level_artificial_tracking_efficiency: 0.98
    5:
      # Test using the new, full refactored steering code
      metadata:
        dataset: *LHC20g4_pythia
        sample_dataset_fraction: 0.1
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 5
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_EEC_embed
        event_activity: "central"
        chunk_size: 1000
        combinatorics_chunk_size: 250
        # Artificial tracking efficiency to convert tracking in PYTHIA to similar performance as PbPb
        # Applied only to embedded particles
        det_level_artificial_tracking_efficiency: 0.98
        output_settings:
          primary_output:
            type: "hists"
            reference_name: "hybrid_level_reference_eec"
            container_name: ""
          return_skim: false
          write_chunk_skim: false
          write_skim_extension: "parquet"
          return_merged_hists: false
          write_chunk_hists: false
          write_merged_hists: true

    60:
      metadata:
        <<: *base_metadata_embed_thermal_model
        dataset: *LHC20g4_pythia
        # Equivalent to train number, but a more general term makes more sense here.
        production_number: 60
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 5000
        background_subtraction:
          r_max: 0.25
        # Artificial tracking efficiency derived from the full jet R_AA paper.
        # 10-30 \approx .99
        # 0-10% \approx .98
        # Apply only to embedded particles
        det_level_artificial_tracking_efficiency: 0.99
    # **********************************************
    # Added new grooming methods, adding z_cut to DyG
    # ***********************************************
    61:
      # Nominal. Added 31 Jan 2023
      metadata:
        <<: *base_metadata_embed_thermal_model
        dataset: *LHC20g4_pythia
        production_number: 61
        label: "embed_pythia_semi_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "semi_central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.99
    62:
      # Nominal. Added 6 Feb 2023
      metadata:
        <<: *base_metadata_embed_thermal_model
        dataset: *LHC20g4_pythia
        production_number: 62
        label: "embed_pythia_central"
      settings:
        <<: *analysis_settings_hardest_kt_embed_R02
        event_activity: "central"
        chunk_size: 4000
        background_subtraction:
          r_max: 0.1
        det_level_artificial_tracking_efficiency: 0.98
